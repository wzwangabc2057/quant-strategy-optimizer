# Paper Trading Productionization: PIT Universe + Lag Presets + Capacity/Industry/Turnover Governance

> **PR Type**: Feature
> **Status**: Ready for Review
> **Target**: Production Paper Trading

---

## èƒŒæ™¯ / é—®é¢˜

æœ¬æ¬¡æ”¹é€ è§£å†³ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜ï¼Œä½¿ç­–ç•¥ä» "Paper can run" å‡çº§åˆ° "Paper is operable and close to Live":

### é—®é¢˜ 1: announce_date ç¼ºå¤±é£é™©

ClickHouse çš„ `stock_financial` è¡¨æ—  `announce_date` å­—æ®µï¼Œå­˜åœ¨æ•°æ®æ³„æ¼é£é™©ã€‚éœ€è¦ä½¿ç”¨ `report_date + lag_days` æ¨¡æ‹Ÿè´¢åŠ¡æ•°æ®å¯ç”¨æ—¥ã€‚

### é—®é¢˜ 2: ä¸Šå¸‚æ—¥æœŸä¼°ç®—å¯é æ€§

é€šè¿‡é¦–æ¬¡å‡ºç°æ—¥æœŸä¼°ç®—ä¸Šå¸‚æ—¥æœŸï¼Œå­˜åœ¨è„æ•°æ®è¯¯å¯¼ `min_list_days` è¿‡æ»¤çš„é£é™©ã€‚

### é—®é¢˜ 3: å®ç›˜å¯æ‰§è¡Œæ€§ç¼ºå£

åŸå‚æ•°è¿‡äºæ¿€è¿›:
- `participation_rate = 10%` (åº”ä¸º 1%)
- æ— å®¹é‡è£å‰ªæœºåˆ¶
- æ— æ¢æ‰‹ä¸Šé™çº¦æŸ
- è¡Œä¸šçº¦æŸæœªæ¥å…¥æ•°æ®æº

---

## æœ¬æ¬¡æ”¹é€ å†…å®¹

### 1. è´¢åŠ¡ Lag åˆ†æ¡£

**æ–‡ä»¶**: `config.py`, `backtest/data_alignment.py`

- æ–°å¢ `FINANCIAL_LAG_PRESETS`: base(45å¤©), paper(60å¤©), stress(90å¤©)
- é»˜è®¤ä½¿ç”¨ paper æ¨¡å¼ (60å¤©)
- `DataAlignment` æ”¯æŒå¯é…ç½® `lag_days` å‚æ•°

### 2. Lag æ•æ„Ÿæ€§æ‰«æ

**æ–‡ä»¶**: `backtest/redteam.py`

- `RedTeamAuditor` æ–°å¢ `audit_lag_sensitivity()` æ–¹æ³•
- æ‰«æ 45/60/90 å¤©å»¶è¿Ÿå¯¹æ”¶ç›Šçš„å½±å“
- è¾“å‡º `lag_sensitivity.csv`
- éªŒè¯ç»“è®º: 45â†’90å¤©æ”¶ç›Šå˜åŠ¨ä»… 1.5%ï¼ˆä¸æ•æ„Ÿï¼‰

### 3. å®¹é‡è£å‰ª (Capacity Clip) - å‰ç½®ç”Ÿæ•ˆ

**æ–‡ä»¶**: `strategy/governance.py`

- `PortfolioGovernance.apply_capacity_clip()` åŸºäº ADV20 Ã— participation_rate
- åœ¨è®¢å•ç”Ÿæˆå‰ç”Ÿæ•ˆï¼Œé¿å…ç›®æ ‡æŒä»“è¶…è¿‡å¸‚åœºå®¹é‡
- è¾“å‡º `capacity_clip_report.csv`

### 4. è¡Œä¸šçº¦æŸ (Industry Cap)

**æ–‡ä»¶**: `strategy/governance.py`, `data/fetcher.py`

- æ¥å…¥ `stock_block_em` è¡¨è·å–è¡Œä¸šåˆ†ç±» (85ä¸ªè¡Œä¸š, 4582åªè‚¡ç¥¨)
- R4: è¡Œä¸šä¸Šé™ 25%, R5: è¡Œä¸šä¸Šé™ 30%
- è¾“å‡º `industry_clip_report.csv`

### 5. æ¢æ‰‹ä¸Šé™ (Turnover Cap) - å‰ç½®ç”Ÿæ•ˆ

**æ–‡ä»¶**: `strategy/governance.py`

- å•æ¬¡æœ€å¤§æ¢æ‰‹ 30%
- åœ¨è®¢å•ç”Ÿæˆå‰ç”Ÿæ•ˆ
- è¾“å‡º `turnover_clip_report.json`

### 6. Universe å¯é æ€§è¿‡æ»¤

**æ–‡ä»¶**: `backtest/universe.py`

- æ–°å¢ `listing_reliability` æ£€æŸ¥
- è¿‡æ»¤ä¸Šå¸‚æ—¥æœŸä¼°ç®—ä¸å¯é çš„è‚¡ç¥¨ (æ•°æ®è¿ç»­æ€§é˜ˆå€¼ 80%)
- æ–°å¢ `FLAG_LISTING_UNRELIABLE` å‰”é™¤åŸå› 

### 7. CLI å‚æ•°é€ä¼ 

**æ–‡ä»¶**: `run_all_v2.py`

- `--lag-days`, `--lag-mode`: è´¢åŠ¡å»¶è¿Ÿé…ç½®
- `--participation-rate`, `--max-turnover`: æ‰§è¡Œå‚æ•°
- `--industry-cap`, `--single-cap`: æ²»ç†çº¦æŸ
- `--capital`: Paper Trading èµ„é‡‘è§„æ¨¡

---

## é£é™©ä¸å‡è®¾

| é£é™©é¡¹ | å¤„ç†æ–¹å¼ | å‡è®¾æ¡ä»¶ |
|--------|----------|----------|
| `announce_date` ç¼ºå¤± | ä½¿ç”¨ `report_date + lag_days=60` æ¨¡æ‹Ÿ | 60å¤©è¶³å¤Ÿè¦†ç›–å¤§éƒ¨åˆ†æŠ«éœ²å»¶è¿Ÿ |
| `listing_date` ä¼°ç®— | é¦–æ¬¡å‡ºç°æ—¥æœŸ + reliability è¿‡æ»¤ (é˜ˆå€¼80%) | æ•°æ®è¿ç»­æ€§å¯ä»£è¡¨å¯é æ€§ |
| ä½£é‡‘è´¹ç‡ | ä¹°å…¥0.026%/å–å‡º0.126% | å†™å…¥ `assumptions.json` |
| èµ„é‡‘è§„æ¨¡ | é»˜è®¤100ä¸‡ | å¯é€šè¿‡ `--capital` è°ƒæ•´ |

---

## éªŒæ”¶è¯æ®

### éªŒè¯ç¯å¢ƒ

| é¡¹ç›® | å€¼ |
|------|-----|
| æ‰§è¡Œæœºå™¨ | macstudio@192.168.0.88 |
| ClickHouse | 192.168.0.74:8123 |
| Python | 3.9.6 |
| Run ID | `redteam_20260215_224410` |

### Gate v2 éªŒæ”¶è¡¨

| äº§å“çº¿ | æ¡ä»¶ | æ•°å€¼ | é˜ˆå€¼ | ç»“æœ |
|--------|------|------|------|------|
| R4 | Stress1å¹´åŒ– | 28.4% | â‰¥18.0% | âœ… PASS |
| R4 | å›æ’¤P75 | 13.5% | â‰¤20.0% | âœ… PASS |
| R4 | å¤æ™®P50 | 2.25 | â‰¥1.0 | âœ… PASS |
| R4 | æ¢æ‰‹ | 2.5x | â‰¤3.0x | âœ… PASS |
| R4 | æˆæœ¬å æ¯” | 20.0% | â‰¤35.0% | âœ… PASS |
| R5 | Stress1å¹´åŒ– | 30.9% | â‰¥20.0% | âœ… PASS |
| R5 | å›æ’¤P75 | 12.5% | â‰¤25.0% | âœ… PASS |
| R5 | å¤æ™®P50 | 2.24 | â‰¥1.0 | âœ… PASS |
| R5 | æ¢æ‰‹ | 2.5x | â‰¤5.0x | âœ… PASS |
| R5 | æˆæœ¬å æ¯” | 20.0% | â‰¤45.0% | âœ… PASS |

**Gate v2 ç»“è®º: 10/10 æ¡ä»¶å…¨ PASS**

### å…³é”®å®¡è®¡ç»“è®º

| æ£€æŸ¥é¡¹ | ç»“æœ | è¯¦æƒ… |
|--------|------|------|
| A) Lagæ•æ„Ÿæ€§ | âœ… ä¸æ•æ„Ÿ | 45å¤©=33.93%, 60å¤©=33.43%, 90å¤©=32.43% (å˜åŠ¨1.5%) |
| B) å®¹é‡è£å‰ª | âœ… æœªè§¦å‘ | è£å‰ªè‚¡ç¥¨æ•°: 0, æ— è¶… cap_i ç›®æ ‡ä¹°å…¥ |
| C) è¡Œä¸šè£å‰ª | âœ… å·²ç”Ÿæ•ˆ | 1æ¬¡è£å‰ª (æœºæ¢°è®¾å¤‡), è£å‰ªåæ— è¶…é™ |
| D) æ¢æ‰‹è£å‰ª | âœ… æœªè§¦å‘ | æ¢æ‰‹ 26.5% < 30% ä¸Šé™ |
| E) asofæŠ½æ · | âœ… æ— æ³„æ¼ | 300æ ·æœ¬, 0å¤±è´¥è¡Œ |
| F) Gate v2 | âœ… å…¨é€šè¿‡ | R4: 5/5, R5: 5/5 |

### äº§ç‰©æ–‡ä»¶

```
results/redteam_20260215_224410/
â”œâ”€â”€ assumptions.json
â”œâ”€â”€ kpi_table.csv
â”œâ”€â”€ metrics.json
â”œâ”€â”€ params.json
â”œâ”€â”€ stress_results.csv
â””â”€â”€ redteam_samples/
    â”œâ”€â”€ asof_samples.csv
    â”œâ”€â”€ capacity_clip_report.csv
    â”œâ”€â”€ constraint_impact.csv
    â”œâ”€â”€ cost_stress.csv
    â”œâ”€â”€ industry_clip_report.csv
    â”œâ”€â”€ lag_sensitivity.csv
    â”œâ”€â”€ prod_acceptance_report.md
    â””â”€â”€ turnover_clip_report.json
```

---

## Paper Trading å†»ç»“å‚æ•°

| å‚æ•° | å†»ç»“å€¼ | è¯´æ˜ |
|------|--------|------|
| lag_days | 60 | paperæ¨¡å¼é»˜è®¤å»¶è¿Ÿ |
| lag_mode | paper | ä¿å®ˆæ¨¡å¼ |
| participation_rate | 0.01 (1%) | æœ€å¤§å‚ä¸ç‡ |
| max_turnover | 0.30 (30%) | å•æ¬¡æœ€å¤§æ¢æ‰‹ |
| industry_cap | 0.25 (25%) | è¡Œä¸šæƒé‡ä¸Šé™ |
| single_cap | 0.08 (8%) | å•ç¥¨æƒé‡ä¸Šé™ |
| min_list_days | 60 | æœ€å°ä¸Šå¸‚å¤©æ•° |
| min_adv | 2000ä¸‡å…ƒ | æœ€å°ADV20é—¨æ§› |
| rebalance_freq | monthly | è°ƒä»“é¢‘ç‡ |
| capital | 1,000,000 | Paper Tradingèµ„é‡‘è§„æ¨¡ |

---

## å›æ»šç­–ç•¥

æ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶ç«‹å³å›æ»šåˆ° v3:

| æ¡ä»¶ | é˜ˆå€¼ | è§¦å‘åŠ¨ä½œ |
|------|------|----------|
| 2ä¸ªæœˆç´¯è®¡æ”¶ç›Š | < -5% | å›æ»šåˆ° v3 |
| 3ä¸ªæœˆå¤æ™®æ¯”ç‡ | < 1.0 | å›æ»šåˆ° v3 |
| æœ€å¤§å›æ’¤ | R4 > 25% æˆ– R5 > 30% | å›æ»šåˆ° v3 |

---

## Commits

| Commit | ç±»å‹ | æè¿° |
|--------|------|------|
| b9cb881 | feat(backtest) | è´¢åŠ¡lagåˆ†æ¡£ + lagæ•æ„Ÿæ€§å®¡è®¡ |
| 221a95f | feat(governance) | å®¹é‡/æ¢æ‰‹/è¡Œä¸šçº¦æŸ + è£å‰ªæŠ¥å‘Š |
| 137c256 | feat(cli) | CLIå‚æ•° + éªŒè¯è„šæœ¬ |
| 0fecbc8 | docs | æ•°æ®æ¸…å• + Universeæ–‡æ¡£ |
| b19362f | chore | æ›´æ–°.gitignore |

---

## æœ€ç»ˆè£å†³

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                      â•‘
â•‘   ğŸŸ¢ GO - å…è®¸è¿›å…¥ Paper Trading                                     â•‘
â•‘                                                                      â•‘
â•‘   æ¨¡å¼: Dynamic Universe (PIT) - æ— å¹¸å­˜è€…åå·®                        â•‘
â•‘                                                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```
